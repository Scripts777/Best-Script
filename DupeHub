local player = game.Players.LocalPlayer
local backpack = player:WaitForChild("Backpack")
local UIS = game:GetService("UserInputService")

local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "BackpackDupeGUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 260, 0, 290)
frame.Position = UDim2.new(0.5, -130, 0.5, -145)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.BorderSizePixel = 0

local titleBar = Instance.new("TextLabel", frame)
titleBar.Size = UDim2.new(1, 0, 0, 20)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.Text = "üì¶ Backpack Dupe"
titleBar.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
titleBar.TextColor3 = Color3.new(1, 1, 1)
titleBar.Font = Enum.Font.SourceSansBold
titleBar.TextSize = 14
titleBar.TextXAlignment = Enum.TextXAlignment.Left

-- –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ GUI
local dragging, dragInput, dragStart, startPos
titleBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

titleBar.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

UIS.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end
end)

-- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
local dropdown = Instance.new("TextButton", frame)
dropdown.Size = UDim2.new(1, -20, 0, 30)
dropdown.Position = UDim2.new(0, 10, 0, 30)
dropdown.Text = "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç"
dropdown.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
dropdown.TextColor3 = Color3.new(1,1,1)

-- –ü–æ–ª—è –≤–≤–æ–¥–∞
local weightLabel = Instance.new("TextLabel", frame)
weightLabel.Size = UDim2.new(0, 100, 0, 20)
weightLabel.Position = UDim2.new(0, 10, 0, 120)
weightLabel.Text = "–í–µ—Å:"
weightLabel.TextColor3 = Color3.new(1, 1, 1)
weightLabel.BackgroundTransparency = 1
weightLabel.Font = Enum.Font.SourceSans
weightLabel.TextSize = 14
weightLabel.TextXAlignment = Enum.TextXAlignment.Left

local weightInput = Instance.new("TextBox", frame)
weightInput.Size = UDim2.new(0, 60, 0, 20)
weightInput.Position = UDim2.new(0, 50, 0, 120)
weightInput.PlaceholderText = "10"
weightInput.Text = ""
weightInput.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
weightInput.TextColor3 = Color3.new(1,1,1)
weightInput.ClearTextOnFocus = false

local ageLabel = Instance.new("TextLabel", frame)
ageLabel.Size = UDim2.new(0, 100, 0, 20)
ageLabel.Position = UDim2.new(0, 130, 0, 120)
ageLabel.Text = "–í–æ–∑—Ä–∞—Å—Ç:"
ageLabel.TextColor3 = Color3.new(1, 1, 1)
ageLabel.BackgroundTransparency = 1
ageLabel.Font = Enum.Font.SourceSans
ageLabel.TextSize = 14
ageLabel.TextXAlignment = Enum.TextXAlignment.Left

local ageInput = Instance.new("TextBox", frame)
ageInput.Size = UDim2.new(0, 60, 0, 20)
ageInput.Position = UDim2.new(0, 190, 0, 120)
ageInput.PlaceholderText = "5"
ageInput.Text = ""
ageInput.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
ageInput.TextColor3 = Color3.new(1,1,1)
ageInput.ClearTextOnFocus = false

-- –ö–Ω–æ–ø–∫–∏
local dupeOne = Instance.new("TextButton", frame)
dupeOne.Size = UDim2.new(0.48, -5, 0, 30)
dupeOne.Position = UDim2.new(0, 10, 0, 240)
dupeOne.Text = "DUPE"
dupeOne.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
dupeOne.TextColor3 = Color3.new(1,1,1)

local dupeAll = Instance.new("TextButton", frame)
dupeAll.Size = UDim2.new(0.48, -5, 0, 30)
dupeAll.Position = UDim2.new(0.52, 0, 0, 240)
dupeAll.Text = "DUPE –í–°–Å"
dupeAll.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
dupeAll.TextColor3 = Color3.new(1,1,1)

-- –°–ø–∏—Å–æ–∫
local dropdownFrame = Instance.new("ScrollingFrame", frame)
dropdownFrame.Size = UDim2.new(1, -20, 0, 80)
dropdownFrame.Position = UDim2.new(0, 10, 0, 65)
dropdownFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
dropdownFrame.Visible = false
dropdownFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
dropdownFrame.ScrollBarThickness = 6
dropdownFrame.BorderSizePixel = 0

local selectedItem = nil
local clonedInstances = {}

local blockedWords = {
    "Favorite", "Trowel", "Shovel", "Spray",
    "Recall", "Sprinkler", "Glass", "Egg"
}

local function isAllowed(item)
    if item:IsA("ObjectValue") then return false end
    for _, word in ipairs(blockedWords) do
        if string.find(item.Name:lower(), word:lower()) then
            return false
        end
    end
    if clonedInstances[item] then return false end
    return true
end

local function updateItemList()
    dropdownFrame:ClearAllChildren()
    local y = 0
    for _, item in pairs(backpack:GetChildren()) do
        if isAllowed(item) then
            local btn = Instance.new("TextButton", dropdownFrame)
            btn.Size = UDim2.new(1, 0, 0, 24)
            btn.Position = UDim2.new(0, 0, 0, y)
            btn.Text = item.Name
            btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
            btn.TextColor3 = Color3.new(1,1,1)
            btn.TextScaled = true

            btn.MouseButton1Click:Connect(function()
                selectedItem = item
                dropdown.Text = "–í—ã–±—Ä–∞–Ω: " .. item.Name
                dropdownFrame.Visible = false
            end)

            y += 24
        end
    end
    dropdownFrame.CanvasSize = UDim2.new(0, 0, 0, y)
end

dropdown.MouseButton1Click:Connect(function()
    dropdownFrame.Visible = not dropdownFrame.Visible
    if dropdownFrame.Visible then
        updateItemList()
    end
end)

local function getWeight()
    local value = tonumber(weightInput.Text)
    return value or tonumber(weightInput.PlaceholderText)
end

local function getAge()
    local value = tonumber(ageInput.Text)
    return value or tonumber(ageInput.PlaceholderText)
end

dupeOne.MouseButton1Click:Connect(function()
    if selectedItem and isAllowed(selectedItem) then
        local clone = selectedItem:Clone()
        clone.Parent = backpack
        clone:SetAttribute("Weight", getWeight())
        clone:SetAttribute("Age", getAge())
        clonedInstances[selectedItem] = true
        updateItemList()
    else
        warn("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø—Ä–µ–¥–º–µ—Ç.")
    end
end)

dupeAll.MouseButton1Click:Connect(function()
    local count = 0
    for _, item in pairs(backpack:GetChildren()) do
        if isAllowed(item) then
            local clone = item:Clone()
            clone.Parent = backpack
            clone:SetAttribute("Weight", getWeight())
            clone:SetAttribute("Age", getAge())
            clonedInstances[item] = true
            count += 1
        end
    end
    print("–ö–ª–æ–Ω–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ:", count)
    updateItemList()
end)
